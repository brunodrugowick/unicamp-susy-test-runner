name: "Pull Request"

on:
  pull_request:
    # The specific activity types are listed here to include "labeled" and "unlabeled"
    # (which are not included by default for the "pull_request" trigger).
    # This is needed to allow skipping enforcement of the changelog in PRs with specific labels,
    # as defined in the (optional) "skipLabels" property.
    types: [ opened, synchronize, reopened, ready_for_review, labeled, unlabeled ]
    branches: [ main ]

  workflow_dispatch:

jobs:
  pull_request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
  
      - name: Run the script
        run: |
          read -r -d '' EXPECTED << EOM
        
        arq01 --> ERROR!
              Got:        True
              Expected:   False
        arq02 --> OK
        arq03 --> OK
        arq04 --> ERROR!
              Got:        True
              Expected:   False
        arq05 --> ERROR!
              Got:        True
              Expected:   False
        arq06 --> OK
        arq07 --> OK
        arq08 --> ERROR!
              Got:        True
              Expected:   False
        arq09 --> OK
        arq10 --> ERROR!
              Got:        True
              Expected:   False
        
        EOM
          diff <(echo $EXPECTED) <(./test/test.sh)

  prod-check:
    if: ${{ failure() }}
    runs-on: ubuntu-latest
    steps:
      - uses: mshick/add-pr-comment@v1
        with:
          message: |
            This PR failed, dude!
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          repo-token-user-login: 'github-actions[bot]' # The user.login for temporary GitHub tokens

